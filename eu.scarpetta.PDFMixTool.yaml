app-id: eu.scarpetta.PDFMixTool
runtime: org.kde.Platform
runtime-version: "6.10"
sdk: org.kde.Sdk
command: pdfmixtool
finish-args:
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=host
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/man
  - '*.a'
modules:
  - name: qpdf
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
    sources:
      - type: archive
        url: https://github.com/qpdf/qpdf/releases/download/v12.2.0/qpdf-12.2.0.tar.gz
        sha256: b3d1575b2218badc3549d6977524bb0f8c468c6528eebc8967bbe3078cf2cace
    cleanup:
      - /include
      - /bin
      - /share/doc

  - name: poppler
    buildsystem: cmake-ninja
    config-opts:
      - -DENABLE_UTILS=OFF
      - -DENABLE_CPP=OFF
      - -DENABLE_QT5=OFF
      - -DENABLE_QT6=ON
      - -DENABLE_BOOST=OFF
    sources:
      - url: https://poppler.freedesktop.org/poppler-25.12.0.tar.xz
        sha256: c18b40eb36b1a0c5b86e29ca054bf0770304583da4f2cdd42fe86eca6a20de48
        type: archive
        x-checker-data:
          type: anitya
          project-id: 3686
          stable-only: true
          url-template: https://poppler.freedesktop.org/poppler-$version.tar.xz

  - name: imagemagick
    config-opts:
      - --enable-shared
      - --disable-static
      - --with-modules
      - --with-x
      - --with-threads
      - --with-magick_plus_plus
      - --with-png
      - --with-jpg
      - --with-gif
      - --with-tiff
    sources:
      - type: archive
        url: https://github.com/ImageMagick/ImageMagick/archive/7.1.1-43.tar.gz
        sha256: ceb972266b23dc7c1cfce0da5a7f0c9acfb4dc81f40eb542a49476fedbc2618f
    cleanup:
      - /share/doc

  - name: pdfmixtool
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
    sources:
      - type: archive
        url: https://gitlab.com/scarpetta/pdfmixtool/-/archive/v1.2.1/pdfmixtool-v1.2.1.tar.gz
        sha256: 0ea40d4d850f7dcc254ab02ec27544ad0c8f411a16f1faeb4503e447a4ea034d
      - type: patch
        path: patches/pdfmixtool-magick++-fix.patch
